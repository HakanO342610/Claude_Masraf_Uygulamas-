#!/bin/bash
# Pre-push hook: GitHub'a (veya herhangi bir remote repo'ya) pushlamadan Ã¶nce Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r
echo "ğŸš€ [Git Hook] pre-push kontrolleri baÅŸlatÄ±lÄ±yor..."
echo "Branch ve gÃ¼ncellemeler kontrol ediliyor..."

# 1. Main veya master dalÄ±na doÄŸrudan pushlamayÄ± yasaklamak (Opsiyonel GÃ¼venlik)
# current_branch=$(git symbolic-ref HEAD | sed -e 's,.*/\(.*\),\1,')
# if [ "$current_branch" == "main" ] || [ "$current_branch" == "master" ]; then
#     echo "âŒ Hata: 'main' veya 'master' dalÄ±na doÄŸrudan push yapÄ±lamaz! PR (Pull Request) aÃ§malÄ±sÄ±nÄ±z."
#     exit 1
# fi

# 2. Gereksiz veya geÃ§ici dizinlerin (node_modules, build/) repo'da var olup olmadÄ±ÄŸÄ±nÄ± denetle
unwanted_dirs=("node_modules" "dist" "build" "coverage")
for dir in "${unwanted_dirs[@]}"; do
    # tree Ã¼zerinde bu klasÃ¶rlerden biri varsa ve git ignore tarafÄ±ndan yakalanmamÄ±ÅŸsa uyar
    if git ls-files | grep -q "^$dir/"; then
        echo "âŒ Hata: '$dir/' klasÃ¶rÃ¼ iÃ§erisindeki dosyalar Git deposunda bulundu! LÃ¼tfen .gitignore dosyasÄ±nÄ± kontrol edin ve takip edilen (tracked) olmaktan Ã§Ä±karÄ±n."
        echo "   Ã‡Ã¶zÃ¼m komutu: git rm -r --cached $dir"
        exit 1
    fi
done

# 3. Son Test ve Build kontrolleri (Node.js Workspace Ä°Ã§in)
if [ -f "package.json" ]; then
    echo "ğŸ“¦ npm projeleri algÄ±landÄ±... Build testleri yÃ¼rÃ¼tÃ¼lÃ¼yor."
    # Buildlerin Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan emin olmak iÃ§in projeyi derlemeyi deneriz (varsa).
    # npm run build:all komutu eÄŸer hata verirse push iÅŸlemi baÅŸarÄ±sÄ±z olur
    npm run build:all --if-present
    if [ $? -ne 0 ]; then
        echo "âŒ Hata: KodlarÄ±nÄ±z derleme (build) sÄ±rasÄ±nda hata aldÄ±."
        echo "âŒ LÃ¼tfen hatalarÄ± dÃ¼zelttikten sonra yeniden pushlayÄ±n."
        exit 1
    fi
else
    echo "âš ï¸ UyarÄ±: 'package.json' bulunamadÄ±, build adÄ±mÄ± atlanÄ±yor."
fi

echo "âœ… TÃ¼m kontroller baÅŸarÄ±yla tamamlandÄ±. Yenilikler yÃ¼kleniyor (Pushing)..."
exit 0
