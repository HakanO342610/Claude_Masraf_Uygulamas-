#!/bin/bash
# Pre-commit hook: Commit Ã¶ncesi hÄ±zlÄ± kontrolleri yapar
echo "ğŸ”„ [Git Hook] pre-commit kontrolleri baÅŸlatÄ±lÄ±yor..."

# 1. Dosya boyutu kontrolÃ¼ (Ã–rn: 5MB'dan bÃ¼yÃ¼k dosyalar commitlenemez)
max_size=5242880 # 5MB in bytes
files=$(git diff --cached --name-only --diff-filter=A | while read filename; do
    if [ -f "$filename" ]; then
        size=$(stat -f %z "$filename" 2>/dev/null || stat -c %s "$filename" 2>/dev/null)
        if [ "$size" -gt $max_size ]; then
            echo "âŒ Hata: '$filename' dosyasÄ± 5MB'dan bÃ¼yÃ¼k ($size bytes). Push Ã¶ncesi temizleyin!"
            exit 1
        fi
    fi
done)

if [ $? -ne 0 ]; then
    echo "$files"
    echo "âŒ LÃ¼tfen bÃ¼yÃ¼k dosyalarÄ± '.gitignore' dosyasÄ±na ekleyin."
    exit 1
fi

# 2. .env dosyalarÄ±nÄ±n veya ÅŸifrelerin yanlÄ±ÅŸlÄ±kla commitlenmesini Ã¶nleme
matches=$(git diff --cached --name-only | grep -E '\.env|password|secret|key')
if [ ! -z "$matches" ]; then
    echo "âš ï¸ UyarÄ±: Åifre veya gizli anahtar (API Key, .env) barÄ±ndÄ±rabilecek dosyalar ekliyor olabilirsiniz:"
    echo "$matches"
    echo "EÄŸer eminseniz commitinize devam edebilirsiniz ama lÃ¼tfen kontrol edin."
fi

# 3. Basit sÃ¶z dizimi kontrolleri (opsiyonel)
# Ã–rneÄŸin js dosyalarÄ± iÃ§in basit syntax check:
# for file in $(git diff --name-only --cached | grep '\.js$'); do
#    node -c "$file" || exit 1
# done

echo "âœ… pre-commit kontrolleri baÅŸarÄ±yla tamamlandÄ±."
exit 0
