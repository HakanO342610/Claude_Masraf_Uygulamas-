generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  EMPLOYEE
  MANAGER
  FINANCE
  ADMIN
}

enum ExpenseStatus {
  DRAFT
  SUBMITTED
  MANAGER_APPROVED
  FINANCE_APPROVED
  REJECTED
  POSTED_TO_SAP
}

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
}

model User {
  id             String    @id @default(uuid())
  sapEmployeeId  String?   @unique @map("sap_employee_id")
  name           String
  email          String    @unique
  password       String
  department     String?
  role           UserRole  @default(EMPLOYEE)
  managerId      String?   @map("manager_id")
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")

  manager        User?     @relation("UserManager", fields: [managerId], references: [id])
  subordinates   User[]    @relation("UserManager")
  expenses       Expense[]
  approvals      Approval[]
  auditLogs      AuditLog[]

  @@map("users")
}

model Expense {
  id                 String        @id @default(uuid())
  userId             String        @map("user_id")
  expenseDate        DateTime      @map("expense_date")
  amount             Decimal       @db.Decimal(12, 2)
  currency           String        @default("TRY")
  taxAmount          Decimal?      @db.Decimal(12, 2) @map("tax_amount")
  category           String
  projectCode        String?       @map("project_code")
  costCenter         String?       @map("cost_center")
  description        String?
  status             ExpenseStatus @default(DRAFT)
  sapDocumentNumber  String?       @map("sap_document_number")
  receiptUrl         String?       @map("receipt_url")
  createdAt          DateTime      @default(now()) @map("created_at")
  updatedAt          DateTime      @updatedAt @map("updated_at")

  user               User          @relation(fields: [userId], references: [id])
  approvals          Approval[]
  auditLogs          AuditLog[]

  @@map("expenses")
}

model Approval {
  id          String         @id @default(uuid())
  expenseId   String         @map("expense_id")
  approverId  String         @map("approver_id")
  status      ApprovalStatus @default(PENDING)
  comment     String?
  actionDate  DateTime?      @map("action_date")
  createdAt   DateTime       @default(now()) @map("created_at")

  expense     Expense        @relation(fields: [expenseId], references: [id])
  approver    User           @relation(fields: [approverId], references: [id])

  @@map("approvals")
}

model AuditLog {
  id         String   @id @default(uuid())
  userId     String   @map("user_id")
  expenseId  String?  @map("expense_id")
  action     String
  details    String?
  createdAt  DateTime @default(now()) @map("created_at")

  user       User     @relation(fields: [userId], references: [id])
  expense    Expense? @relation(fields: [expenseId], references: [id])

  @@map("audit_logs")
}
